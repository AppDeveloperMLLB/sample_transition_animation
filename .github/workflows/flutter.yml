name: Flutter

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Setup Flutter SDK
        uses: flutter-actions/setup-flutter@v2
        with:
          channel: stable
          version: 3.7.0

      - name: Install dependencies
        run: flutter pub get

      - name: Analyze project source
        run: dart analyze
        
      - name: Format code
        run: dart format lib
        
      - name: Diff
        id: diff
        run: |
          git add -N .
          git diff --name-only --exit-code
        continue-on-error: true

      - name: git setting
        run: |
          git config user.name "$(git --no-pager log --format=format:'%an' -n 1)"
          git config user.email "$(git --no-pager log --format=format:'%ae' -n 1)"
          
      - name: Commit files
        run: |
          git add .
          git commit -m "Apply Format Change" -a
          git pull
          git push
